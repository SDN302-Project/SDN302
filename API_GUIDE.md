# üöÄ PREVENTION API - FRONTEND INTEGRATION GUIDE

## üìñ T·ªïng quan

API h·ªá th·ªëng h·ªó tr·ª£ ph√≤ng ng·ª´a s·ª≠ d·ª•ng ma t√∫y v·ªõi c√°c t√≠nh nƒÉng ch√≠nh:

- Authentication & Authorization (3 roles: member, consultant, admin)
- Qu·∫£n l√Ω kh√≥a h·ªçc v√† ƒëƒÉng k√Ω v·ªõi n·ªôi dung text-based learning
- H·ªá th·ªëng kh·∫£o s√°t ƒë√°nh gi√° r·ªßi ro
- Blog chia s·∫ª kinh nghi·ªám
- Review v√† ƒë√°nh gi√°
- **üéØ H·ªÜ TH·ªêNG ƒê·∫∂T L·ªäCH H·∫∏N HO√ÄN CH·ªàNH V·ªöI CHUY√äN VI√äN T∆Ø V·∫§N**

## üåê Base URLs

- **Production:** `https://prevention-api-tdt.onrender.com/api/v1`
- **Development:** `http://localhost:8001/api/v1`

---

## üë• ROLES SYSTEM (üÜï ƒê∆†N GI·∫¢N H√ìA)

### **3 Roles ch√≠nh:**

- **`member`** - Ng∆∞·ªùi d√πng cu·ªëi (sinh vi√™n)
- **`consultant`** - Chuy√™n vi√™n t∆∞ v·∫•n
- **`admin`** - Qu·∫£n tr·ªã vi√™n

### **Permissions:**

```javascript
member: [
  "view_courses",
  "enroll_courses",
  "take_surveys",
  "book_appointments",
  "write_reviews",
];
consultant: [
  "manage_schedule",
  "mark_noshow",
  "create_blogs",
  "view_client_history",
];
admin: ["manage_users", "manage_content", "view_analytics", "system_config"];
```

---

## üîê 1. AUTHENTICATION ENDPOINTS

### 1.1 ƒêƒÉng k√Ω t√†i kho·∫£n

```http
POST /auth/signup
```

**Request Body:**

```json
{
  "name": "Nguy·ªÖn VƒÉn A",
  "email": "user@example.com",
  "password": "password123",
  "passwordConfirm": "password123"
}
```

**Success Response (201):**

```json
{
  "status": "success"
}
```

**Frontend Usage:**

```javascript
const signup = async (userData) => {
  const response = await fetch(`${BASE_URL}/auth/signup`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(userData),
  });
  return response.json();
};
```

### 1.2 ƒêƒÉng nh·∫≠p

```http
POST /auth/login
```

**Request Body:**

```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

**Success Response (200):**

```json
{
  "status": "success",
  "token": "jwt_token_here",
  "data": {
    "user": {
      "_id": "648abc123def456789",
      "name": "Nguy·ªÖn VƒÉn A",
      "email": "user@example.com",
      "role": "member",
      "photo": "default.jpg"
    }
  }
}
```

### 1.3 ƒêƒÉng nh·∫≠p Google

```http
POST /auth/google-login
```

**Request Body:**

```json
{
  "token": "google_oauth_token"
}
```

### 1.4 Qu√™n m·∫≠t kh·∫©u

```http
POST /auth/forgotPassword
```

**Request Body:**

```json
{
  "email": "user@example.com"
}
```

### 1.5 Reset m·∫≠t kh·∫©u

```http
PATCH /auth/resetPassword/:token
```

**Request Body:**

```json
{
  "password": "newPassword123",
  "passwordConfirm": "newPassword123"
}
```

---

## üìö 2. COURSE ENDPOINTS (üÜï C·∫¨P NH·∫¨T)

### 2.1 L·∫•y danh s√°ch kh√≥a h·ªçc (Public)

```http
GET /courses
```

**Query Parameters:**

- `page`: Trang hi·ªán t·∫°i (default: 1)
- `limit`: S·ªë l∆∞·ª£ng items per page (default: 100)
- `sort`: S·∫Øp x·∫øp (-createdAt, name, duration)
- `targetAudience`: L·ªçc theo ƒë·ªëi t∆∞·ª£ng (student, university_student, parent, teacher)

**Success Response (200):**

```json
{
  "status": "success",
  "results": 5,
  "data": {
    "data": [
      {
        "_id": "648abc123def456789",
        "name": "Nh·∫≠n th·ª©c v·ªÅ ma t√∫y cho sinh vi√™n",
        "description": "Kh√≥a h·ªçc gi√∫p sinh vi√™n nh·∫≠n bi·∫øt t√°c h·∫°i c·ªßa ma t√∫y...",
        "topics": ["nh·∫≠n th·ª©c", "ph√≤ng tr√°nh", "k·ªπ nƒÉng t·ª´ ch·ªëi"],
        "targetAudience": "university_student",
        "duration": 120,
        "author": {
          "name": "Dr. Nguy·ªÖn VƒÉn A",
          "photo": "doctor.jpg"
        },
        "isPublished": true,
        "createdAt": "2025-07-01T08:00:00.000Z"
      }
    ]
  }
}
```

### 2.2 L·∫•y chi ti·∫øt kh√≥a h·ªçc (Public)

```http
GET /courses/:id
```

### 2.3 L·∫•y n·ªôi dung kh√≥a h·ªçc (üÜï CH·ªà CHO ENROLLED USERS)

```http
GET /courses/:id/content
```

**Headers:**

```
Authorization: Bearer jwt_token
```

**Business Rules:**

- ‚ö†Ô∏è Ph·∫£i ƒë√£ ƒëƒÉng k√Ω kh√≥a h·ªçc
- ‚ö†Ô∏è User ph·∫£i ƒëƒÉng nh·∫≠p

**Success Response (200):**

```json
{
  "status": "success",
  "data": {
    "course": {
      "_id": "648abc123def456789",
      "name": "Nh·∫≠n th·ª©c v·ªÅ ma t√∫y cho sinh vi√™n",
      "description": "M√¥ t·∫£ kh√≥a h·ªçc...",
      "topics": ["nh·∫≠n th·ª©c", "ph√≤ng tr√°nh", "k·ªπ nƒÉng t·ª´ ch·ªëi"],
      "duration": 120,
      "content": "# Ch∆∞∆°ng 1: T·ªïng quan v·ªÅ ma t√∫y\n\nMa t√∫y l√† nh·ªØng ch·∫•t g√¢y nghi·ªán...\n\n# Ch∆∞∆°ng 2: T√°c h·∫°i c·ªßa ma t√∫y\n\nVi·ªác s·ª≠ d·ª•ng ma t√∫y g√¢y ra nh·ªØng t√°c h·∫°i nghi√™m tr·ªçng...\n\n# Ch∆∞∆°ng 3: K·ªπ nƒÉng ph√≤ng tr√°nh\n\n1. Nh·∫≠n bi·∫øt d·∫•u hi·ªáu...\n2. T·ª´ ch·ªëi m·ªôt c√°ch l·ªãch s·ª±...",
      "author": {
        "name": "Dr. Nguy·ªÖn VƒÉn A",
        "photo": "doctor.jpg"
      }
    },
    "enrollment": {
      "enrolledAt": "2025-07-01T10:00:00.000Z"
    }
  }
}
```

**Error Response (403):**

```json
{
  "status": "fail",
  "message": "B·∫°n c·∫ßn ƒëƒÉng k√Ω kh√≥a h·ªçc tr∆∞·ªõc khi xem n·ªôi dung"
}
```

### 2.4 ƒêƒÉng k√Ω kh√≥a h·ªçc

```http
POST /courses/:courseId/enrollments
```

**Headers:**

```
Authorization: Bearer jwt_token
```

**Success Response (201):**

```json
{
  "status": "success",
  "data": {
    "data": {
      "_id": "648abc123def456790",
      "course": "648abc123def456789",
      "user": "648abc123def456791",
      "createdAt": "2024-01-15T09:00:00.000Z"
    }
  }
}
```

### 2.5 L·∫•y kh√≥a h·ªçc ƒë√£ ƒëƒÉng k√Ω (üÜï MY COURSES)

```http
GET /enrollments/my-courses
```

**Headers:**

```
Authorization: Bearer jwt_token
```

**Success Response (200):**

```json
{
  "status": "success",
  "results": 2,
  "data": {
    "enrollments": [
      {
        "_id": "enrollment_id_123",
        "course": {
          "_id": "course_id_123",
          "name": "Nh·∫≠n th·ª©c v·ªÅ ma t√∫y cho sinh vi√™n",
          "description": "M√¥ t·∫£ kh√≥a h·ªçc...",
          "duration": 120,
          "topics": ["nh·∫≠n th·ª©c", "ph√≤ng tr√°nh"],
          "targetAudience": "university_student",
          "author": {
            "name": "Dr. Nguy·ªÖn VƒÉn A",
            "photo": "doctor.jpg"
          }
        },
        "createdAt": "2025-07-01T10:00:00.000Z"
      }
    ]
  }
}
```

### 2.6 ƒê√°nh gi√° kh√≥a h·ªçc

```http
POST /courses/:courseId/reviews
```

**Headers:**

```
Authorization: Bearer jwt_token
```

**Request Body:**

```json
{
  "review": "Kh√≥a h·ªçc r·∫•t hay v√† b·ªï √≠ch",
  "rating": 5
}
```

### 2.7 L·∫•y ƒë√°nh gi√° c·ªßa kh√≥a h·ªçc

```http
GET /courses/:courseId/reviews
```

---

## üìù 3. SURVEY ENDPOINTS

### 3.1 L·∫•y danh s√°ch kh·∫£o s√°t

```http
GET /surveys
```

**Headers:**

```
Authorization: Bearer jwt_token
```

**Success Response (200):**

```json
{
  "status": "success",
  "results": 2,
  "data": {
    "data": [
      {
        "_id": "648abc123def456789",
        "name": "ASSIST - Screening Tool",
        "description": "C√¥ng c·ª• s√†ng l·ªçc m·ª©c ƒë·ªô r·ªßi ro s·ª≠ d·ª•ng ch·∫•t",
        "questions": [
          {
            "text": "B·∫°n c√≥ t·ª´ng s·ª≠ d·ª•ng thu·ªëc l√° kh√¥ng?",
            "options": [
              { "text": "Kh√¥ng bao gi·ªù", "score": 0 },
              { "text": "1-2 l·∫ßn", "score": 2 },
              { "text": "Th∆∞·ªùng xuy√™n", "score": 4 }
            ]
          }
        ],
        "author": "648abc123def456788"
      }
    ]
  }
}
```

### 3.2 L·∫•y chi ti·∫øt kh·∫£o s√°t

```http
GET /surveys/:id
```

**Headers:**

```
Authorization: Bearer jwt_token
```

### 3.3 Submit k·∫øt qu·∫£ kh·∫£o s√°t

```http
POST /surveys/:id/submit
```

**Headers:**

```
Authorization: Bearer jwt_token
```

**Request Body:**

```json
{
  "answers": [
    {
      "questionIndex": 0,
      "optionIndex": 1
    },
    {
      "questionIndex": 1,
      "optionIndex": 0
    }
  ]
}
```

**Success Response (201):**

```json
{
  "status": "success",
  "data": {
    "result": {
      "_id": "648abc123def456792",
      "survey": "648abc123def456789",
      "user": "648abc123def456791",
      "answer": [
        {
          "questionText": "B·∫°n c√≥ t·ª´ng s·ª≠ d·ª•ng thu·ªëc l√° kh√¥ng?",
          "chosenOptionText": "1-2 l·∫ßn",
          "score": 2
        }
      ],
      "totalScore": 2,
      "recommendation": "Nguy c∆° th·∫•p. H√£y ti·∫øp t·ª•c duy tr√¨ l·ªëi s·ªëng l√†nh m·∫°nh...",
      "createdAt": "2024-01-15T10:00:00.000Z"
    }
  }
}
```

---

## üì∞ 4. BLOG ENDPOINTS

### 4.1 L·∫•y danh s√°ch blog (Public)

```http
GET /blogs
```

**Success Response (200):**

```json
{
  "status": "success",
  "results": 3,
  "data": {
    "data": [
      {
        "_id": "648abc123def456789",
        "title": "5 c√°ch nh·∫≠n bi·∫øt d·∫•u hi·ªáu s·ª≠ d·ª•ng ma t√∫y",
        "content": "N·ªôi dung b√†i vi·∫øt...",
        "imageCover": "blog-image-1.jpg",
        "author": "648abc123def456788"
      }
    ]
  }
}
```

### 4.2 L·∫•y chi ti·∫øt blog (Public)

```http
GET /blogs/:id
```

---

## üìÖ 5. APPOINTMENT SYSTEM ENDPOINTS (üÜï HO√ÄN CH·ªàNH)

### 5.1 T·∫°o khung th·ªùi gian kh·∫£ d·ª•ng (Consultant only)

```http
POST /appointment-slots/my-slots
```

**Headers:**

```
Authorization: Bearer jwt_token
```

**Request Body:**

```json
{
  "slots": [
    {
      "startTime": "2025-07-20T09:00:00.000Z",
      "endTime": "2025-07-20T10:00:00.000Z"
    },
    {
      "startTime": "2025-07-20T10:00:00.000Z",
      "endTime": "2025-07-20T11:00:00.000Z"
    }
  ]
}
```

**Success Response (201):**

```json
{
  "status": "success",
  "data": {
    "slots": [
      {
        "_id": "648abc123def456789",
        "consultant": "648abc123def456788",
        "startTime": "2025-07-20T09:00:00.000Z",
        "endTime": "2025-07-20T10:00:00.000Z",
        "status": "available",
        "createdAt": "2025-07-09T08:00:00.000Z"
      }
    ]
  }
}
```

### 5.2 Xem t·∫•t c·∫£ slots c·ªßa consultant (Consultant only)

```http
GET /appointment-slots/my-slots
```

**Headers:**

```
Authorization: Bearer jwt_token
```

**Success Response (200):**

```json
{
  "status": "success",
  "results": 5,
  "data": {
    "slots": [
      {
        "_id": "648abc123def456789",
        "consultant": "648abc123def456788",
        "startTime": "2025-07-20T09:00:00.000Z",
        "endTime": "2025-07-20T10:00:00.000Z",
        "status": "booked",
        "bookedBy": {
          "_id": "648abc123def456790",
          "name": "Nguy·ªÖn VƒÉn A",
          "email": "user@example.com",
          "photo": "default.jpg"
        },
        "bookedAt": "2025-07-09T10:00:00.000Z",
        "isNoShow": false
      }
    ]
  }
}
```

### 5.3 Xem khung th·ªùi gian kh·∫£ d·ª•ng c·ªßa consultant (Public)

```http
GET /appointment-slots/consultant/:consultantId
```

**Success Response (200):**

```json
{
  "status": "success",
  "results": 3,
  "data": {
    "slots": [
      {
        "_id": "648abc123def456789",
        "consultant": "648abc123def456788",
        "startTime": "2025-07-20T09:00:00.000Z",
        "endTime": "2025-07-20T10:00:00.000Z",
        "status": "available"
      }
    ]
  }
}
```

### 5.4 ƒê·∫∑t l·ªãch h·∫πn (Member only) üÜï

```http
PATCH /appointment-slots/:slotId/book
```

**Headers:**

```
Authorization: Bearer jwt_token
```

**Business Rules:**

- ‚ö†Ô∏è Ph·∫£i ƒë·∫∑t tr∆∞·ªõc √≠t nh·∫•t 30 ph√∫t
- ‚ö†Ô∏è T·ªëi ƒëa 2 l·ªãch h·∫πn c√πng l√∫c
- ‚ö†Ô∏è T√†i kho·∫£n kh√¥ng b·ªã ban

**Success Response (200):**

```json
{
  "status": "success",
  "message": "ƒê·∫∑t l·ªãch th√†nh c√¥ng!",
  "data": {
    "appointment": {
      "_id": "648abc123def456789",
      "consultant": "648abc123def456788",
      "startTime": "2025-07-20T09:00:00.000Z",
      "endTime": "2025-07-20T10:00:00.000Z",
      "status": "booked",
      "bookedBy": "648abc123def456790",
      "bookedAt": "2025-07-09T10:00:00.000Z"
    }
  }
}
```

**Error Responses:**

```json
// 403 - Banned user
{
  "status": "fail",
  "message": "B·∫°n ƒë√£ t·∫°m th·ªùi b·ªã kho√° ch·ª©c nƒÉng ƒë·∫∑t l·ªãch h·∫πn."
}

// 403 - Too many bookings
{
  "status": "fail",
  "message": "B·∫°n ch·ªâ ƒë∆∞·ª£c ƒë·∫∑t 2 l·ªãch c√πng l√∫c"
}

// 403 - Too close to appointment time
{
  "status": "fail",
  "message": "B·∫°n c·∫ßn ƒë·∫∑t l·ªãch tr∆∞·ªõc √≠t nh·∫•t 30 ph√∫t. Vui l√≤ng ch·ªçn slot kh√°c ho·∫∑c th·ª≠ l·∫°i sau."
}

// 409 - Slot conflict
{
  "status": "fail",
  "message": "R·∫•t ti·∫øc, khung gi·ªù n√†y v·ª´a c√≥ ng∆∞·ªùi kh√°c ƒë·∫∑t ho·∫∑c kh√¥ng t·ªìn t·∫°i."
}
```

### 5.5 H·ªßy l·ªãch h·∫πn (Member only) üÜï

```http
PATCH /appointment-slots/:slotId/cancel
```

**Headers:**

```
Authorization: Bearer jwt_token
```

**Business Rules:**

- ‚ö†Ô∏è **Daily Limit:** T·ªëi ƒëa 3 l·∫ßn h·ªßy/ng√†y
- ‚ö†Ô∏è **Cooldown:** 2 ti·∫øng gi·ªØa c√°c l·∫ßn h·ªßy (khi cancel > 3h tr∆∞·ªõc h·∫πn)
- ‚ö†Ô∏è **Strikes System:** H·ªßy < 3h tr∆∞·ªõc h·∫πn c√≥ th·ªÉ nh·∫≠n c·∫£nh c√°o
- ‚ö†Ô∏è **Grace Period:** 30 ph√∫t ƒë·∫ßu sau booking kh√¥ng b·ªã c·∫£nh c√°o (n·∫øu book < 3h tr∆∞·ªõc h·∫πn)

**Success Response (200):**

```json
{
  "status": "success",
  "message": "H·ªßy l·ªãch th√†nh c√¥ng! C√≤n 2 l·∫ßn h·ªßy h√¥m nay. C√≥ th·ªÉ h·ªßy ti·∫øp sau 2 ti·∫øng.",
  "data": {
    "slotUpdated": {
      "_id": "648abc123def456789",
      "status": "available",
      "cancelledAt": "2025-07-09T11:00:00.000Z"
    }
  }
}
```

**Error Responses:**

```json
// 429 - Daily limit exceeded
{
  "status": "fail",
  "message": "H√¥m nay b·∫°n ƒë√£ h·∫øt l∆∞·ª£t h·ªßy ƒë·∫∑t l·ªãch (3/3). Vui l√≤ng th·ª≠ l·∫°i v√†o ng√†y mai."
}

// 429 - Cooldown active
{
  "status": "fail",
  "message": "B·∫°n c·∫ßn ƒë·ª£i 1 ti·∫øng 30 ph√∫t n·ªØa ƒë·ªÉ c√≥ th·ªÉ h·ªßy l·ªãch ti·∫øp theo"
}

// 403 - Not your appointment
{
  "status": "fail",
  "message": "B·∫°n ch·ªâ c√≥ th·ªÉ h·ªßy l·ªãch h·∫πn c·ªßa m√¨nh"
}
```

### 5.6 Xem l·ªãch h·∫πn ƒë√£ ƒë·∫∑t (Member only) üÜï

```http
GET /appointment-slots/my-bookings
```

**Headers:**

```
Authorization: Bearer jwt_token
```

**Success Response (200):**

```json
{
  "status": "success",
  "results": 2,
  "data": {
    "appointments": [
      {
        "_id": "648abc123def456789",
        "consultant": {
          "_id": "648abc123def456788",
          "name": "Dr. Nguy·ªÖn VƒÉn B",
          "email": "consultant@example.com",
          "photo": "consultant.jpg"
        },
        "startTime": "2025-07-20T09:00:00.000Z",
        "endTime": "2025-07-20T10:00:00.000Z",
        "status": "booked",
        "bookedAt": "2025-07-09T10:00:00.000Z",
        "isNoShow": false
      }
    ]
  }
}
```

### 5.7 ƒê√°nh d·∫•u No-Show (Consultant only) üÜï

```http
PATCH /appointment-slots/:slotId/mark-no-show
```

**Headers:**

```
Authorization: Bearer jwt_token
```

**Business Rules:**

- ‚ö†Ô∏è **+2 Strikes** cho user kh√¥ng ƒë·∫øn h·∫πn
- ‚ö†Ô∏è **Auto-ban 7 ng√†y** n·∫øu ƒë·∫°t 3 strikes
- ‚ö†Ô∏è Ch·ªâ consultant c·ªßa slot m·ªõi c√≥ quy·ªÅn ƒë√°nh d·∫•u

**Success Response (200):**

```json
{
  "status": "success",
  "message": "ƒê√£ ƒë√°nh d·∫•u no-show. User nh·∫≠n 2 c·∫£nh c√°o (2/3).",
  "data": {
    "slot": {
      "_id": "648abc123def456789",
      "isNoShow": true
    },
    "userStatus": {
      "strikes": 2,
      "isBanned": false,
      "banUntil": null
    }
  }
}
```

**Error Responses:**

```json
// 403 - Not your slot
{
  "status": "fail",
  "message": "B·∫°n ch·ªâ c√≥ th·ªÉ ƒë√°nh d·∫•u no-show cho slot c·ªßa m√¨nh"
}

// 400 - Already marked
{
  "status": "fail",
  "message": "Slot n√†y ƒë√£ ƒë∆∞·ª£c ƒë√°nh d·∫•u no-show r·ªìi"
}
```

---

## üë• 6. USER ENDPOINTS

### 6.1 L·∫•y danh s√°ch consultant (Public) üÜï

```http
GET /users/consultants
```

**Headers:**

```
Authorization: Bearer jwt_token
```

**Success Response (200):**

```json
{
  "status": "success",
  "data": {
    "consultantsList": [
      {
        "_id": "648abc123def456788",
        "name": "Dr. Nguy·ªÖn VƒÉn B",
        "email": "consultant@example.com",
        "photo": "consultant.jpg"
      }
    ]
  }
}
```

### 6.2 L·∫•y th√¥ng tin user hi·ªán t·∫°i

```http
GET /users/:id
```

**Headers:**

```
Authorization: Bearer jwt_token
```

### 6.3 L·∫•y danh s√°ch t·∫•t c·∫£ users (Admin only)

```http
GET /users
```

**Headers:**

```
Authorization: Bearer jwt_token
```

### 6.4 X√≥a user (Admin only)

```http
DELETE /users/:id
```

**Headers:**

```
Authorization: Bearer jwt_token
```

---

## üõ°Ô∏è 7. STRIKES & BAN SYSTEM (üÜï HO√ÄN CH·ªàNH)

### **How Strikes Work:**

#### **Strike Scenarios:**

```javascript
// +1 Strike: Cancel appointment < 3 hours before start time
//   (Grace period: 30 minutes after booking if booked < 3h before)

// +2 Strikes: No-show (marked by consultant)

// 3 Strikes = Auto-ban 7 days + Reset strikes to 0
```

#### **Daily Limits:**

```javascript
// Cancel Limits:
// - 3 cancellations per day
// - 2 hours cooldown between cancellations (when canceling > 3h before)

// Booking Limits:
// - Maximum 2 active appointments at once
// - Must book at least 30 minutes in advance
```

#### **Ban System:**

```javascript
// Auto-ban conditions:
// - Accumulate 3 strikes
// - Ban duration: 7 days
// - Auto-reset: Ban expires + strikes reset to 0

// Ban prevents:
// - Booking new appointments
// - All appointment-related actions
```

### **Frontend Strike Display:**

```javascript
// User dashboard should show:
{
  "currentStrikes": 1,
  "maxStrikes": 3,
  "dailyCancellations": 2,
  "maxDailyCancellations": 3,
  "isBanned": false,
  "banUntil": null,
  "nextCancelAvailable": "2025-07-09T13:00:00.000Z"
}
```

---

## üîÑ 8. ERROR HANDLING & STATUS CODES

### **New Error Codes:**

```json
// 429 - Too Many Requests (Rate Limiting)
{
  "status": "fail",
  "message": "H√¥m nay b·∫°n ƒë√£ h·∫øt l∆∞·ª£t h·ªßy ƒë·∫∑t l·ªãch (3/3). Vui l√≤ng th·ª≠ l·∫°i v√†o ng√†y mai."
}

// 429 - Cooldown Active
{
  "status": "fail",
  "message": "B·∫°n c·∫ßn ƒë·ª£i 1 ti·∫øng 30 ph√∫t n·ªØa ƒë·ªÉ c√≥ th·ªÉ h·ªßy l·ªãch ti·∫øp theo"
}

// 403 - User Banned
{
  "status": "fail",
  "message": "B·∫°n ƒë√£ t·∫°m th·ªùi b·ªã kho√° ch·ª©c nƒÉng ƒë·∫∑t l·ªãch h·∫πn."
}
```

### Common Error Responses:

```json
// 400 - Validation Error
{
  "status": "fail",
  "message": "D·ªØ li·ªáu nh·∫≠p v√†o kh√¥ng h·ª£p l·ªá. Email ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng"
}

// 401 - Authentication Error
{
  "status": "fail",
  "message": "B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p"
}

// 403 - Authorization Error
{
  "status": "fail",
  "message": "B·∫°n kh√¥ng c√≥ quy·ªÅn th·ª±c hi·ªán h√†nh ƒë·ªông n√†y"
}

// 404 - Not Found
{
  "status": "fail",
  "message": "Kh√¥ng t√¨m th·∫•y document v·ªõi ID n√†y"
}

// 409 - Conflict (Appointment booking)
{
  "status": "fail",
  "message": "R·∫•t ti·∫øc, khung gi·ªù n√†y v·ª´a c√≥ ng∆∞·ªùi kh√°c ƒë·∫∑t ho·∫∑c kh√¥ng t·ªìn t·∫°i."
}

// 500 - Server Error
{
  "status": "error",
  "message": "ƒê√£ c√≥ s·ª± c·ªë x·∫£y ra t·ª´ h·ªá th·ªëng!"
}
```

---

## üì± 9. FRONTEND IMPLEMENTATION EXAMPLES (üÜï C·∫¨P NH·∫¨T)

### **Complete Appointment Booking Flow:**

```javascript
// 1. Get consultants
const consultants = await api.getConsultants();

// 2. Get available slots for selected consultant
const slots = await api.getAvailableSlots(selectedConsultantId);

// 3. Book appointment
const booking = await api.bookAppointmentSlot(selectedSlotId);
```

### **Appointment Management Flow:**

```javascript
// Member: View my bookings
const myBookings = await api.getMyBookings();

// Member: Cancel appointment (with error handling)
try {
  const result = await api.cancelAppointmentSlot(slotId);
  alert(result.message); // Success message with remaining cancellations
} catch (error) {
  if (error.message.includes("429")) {
    // Rate limited - show cooldown time or daily limit
    alert("B·∫°n ƒë√£ h·∫øt l∆∞·ª£t h·ªßy ho·∫∑c c·∫ßn ch·ªù cooldown");
  }
}

// Consultant: View my schedule
const mySlots = await api.getMySlots();

// Consultant: Mark no-show
const noShowResult = await api.markNoShow(slotId);
```

### **Error Handling for Strikes System:**

```javascript
const handleBookingError = (error) => {
  const message = error.message;

  if (message.includes("kho√° ch·ª©c nƒÉng ƒë·∫∑t l·ªãch")) {
    // User is banned
    showBanNotification(user.banUntil);
  } else if (message.includes("2 l·ªãch c√πng l√∫c")) {
    // Too many active bookings
    showBookingLimitWarning();
  } else if (message.includes("30 ph√∫t")) {
    // Too close to appointment time
    showTimeWarning();
  } else if (message.includes("409")) {
    // Slot conflict
    refreshAvailableSlots();
  }
};

const handleCancelError = (error) => {
  const message = error.message;

  if (message.includes("h·∫øt l∆∞·ª£t h·ªßy")) {
    // Daily limit reached
    showDailyLimitMessage();
  } else if (message.includes("ƒë·ª£i") && message.includes("ti·∫øng")) {
    // Cooldown active
    const timeMatch = message.match(/(\d+) ti·∫øng (\d+) ph√∫t/);
    if (timeMatch) {
      showCooldownTimer(timeMatch[1], timeMatch[2]);
    }
  }
};
```

### **User Status Dashboard:**

```javascript
const UserAppointmentStatus = () => {
  const [userStatus, setUserStatus] = useState(null);

  const fetchUserStatus = async () => {
    // Get current user appointment status
    const user = api.getCurrentUser();
    const bookings = await api.getMyBookings();

    setUserStatus({
      activeBookings: bookings.data.appointments.length,
      maxBookings: 2,
      isBanned: user.appointmentProfile?.isBanned || false,
      strikes: user.appointmentProfile?.strikes || 0,
      banUntil: user.appointmentProfile?.banUntil,
    });
  };

  return (
    <div className="user-status">
      {userStatus?.isBanned && (
        <Alert type="error">
          T√†i kho·∫£n b·ªã kh√≥a ƒë·∫∑t l·ªãch ƒë·∫øn:{" "}
          {new Date(userStatus.banUntil).toLocaleDateString()}
        </Alert>
      )}

      <div className="status-grid">
        <StatusCard
          title="L·ªãch h·∫πn hi·ªán t·∫°i"
          value={`${userStatus?.activeBookings || 0}/2`}
          warning={userStatus?.activeBookings >= 2}
        />

        <StatusCard
          title="C·∫£nh c√°o"
          value={`${userStatus?.strikes || 0}/3`}
          warning={userStatus?.strikes >= 2}
        />
      </div>
    </div>
  );
};
```

---

## üß™ 10. TESTING ENDPOINTS (üÜï C·∫¨P NH·∫¨T)

### **Test Complete Appointment Flow:**

```bash
# 1. Login as member
curl -X POST https://prevention-api-tdt.onrender.com/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"member@example.com","password":"password123"}'

# 2. Get consultants
curl -H "Authorization: Bearer YOUR_TOKEN" \
  https://prevention-api-tdt.onrender.com/api/v1/users/consultants

# 3. Get available slots
curl -H "Authorization: Bearer YOUR_TOKEN" \
  https://prevention-api-tdt.onrender.com/api/v1/appointment-slots/consultant/CONSULTANT_ID

# 4. Book appointment
curl -X PATCH https://prevention-api-tdt.onrender.com/api/v1/appointment-slots/SLOT_ID/book \
  -H "Authorization: Bearer YOUR_TOKEN"

# 5. View my bookings
curl -H "Authorization: Bearer YOUR_TOKEN" \
  https://prevention-api-tdt.onrender.com/api/v1/appointment-slots/my-bookings

# 6. Cancel appointment
curl -X PATCH https://prevention-api-tdt.onrender.com/api/v1/appointment-slots/SLOT_ID/cancel \
  -H "Authorization: Bearer YOUR_TOKEN"

# 7. Consultant mark no-show
curl -X PATCH https://prevention-api-tdt.onrender.com/api/v1/appointment-slots/SLOT_ID/mark-no-show \
  -H "Authorization: Bearer CONSULTANT_TOKEN"
```

---

## üéØ COMPLETE USER JOURNEY (üÜï C·∫¨P NH·∫¨T)

### **Low Risk User Journey:**

```
Survey ‚Üí Low Risk Score ‚Üí Blog Reading ‚Üí Stay Informed
```

### **Medium Risk User Journey:**

```
Survey ‚Üí Medium Risk Score ‚Üí Course Recommendation ‚Üí
Enroll ‚Üí Complete Course ‚Üí Review Course
```

### **High Risk User Journey:**

```
Survey ‚Üí High Risk Score ‚Üí Appointment Recommendation ‚Üí
Get Consultants ‚Üí Select Consultant ‚Üí View Available Slots ‚Üí
Book Appointment ‚Üí Attend Meeting ‚Üí (Possible Follow-up Bookings)
```

### **Consultant Journey:**

```
Login ‚Üí Create Weekly Schedule ‚Üí View Bookings ‚Üí
Conduct Appointments ‚Üí Mark No-Shows (if any) ‚Üí
Manage Schedule ‚Üí Create Blog Content
```

---

## üì± MOBILE APP COURSE LEARNING FLOW (üÜï)

### **Simple Text-Based Learning cho Sinh Vi√™n:**

#### **1. Course Discovery:**

```javascript
// Get courses by target audience
const courses = await api.getCourses({
  targetAudience: "university_student",
  page: 1,
  limit: 10,
});
```

#### **2. Course Enrollment:**

```javascript
// Enroll in course
const enrollment = await api.enrollInCourse(courseId);

// Get my courses
const myCourses = await api.getMyCourses();
```

#### **3. Course Learning:**

```javascript
// Access course content (only for enrolled users)
const courseContent = await api.getCourseContent(courseId);

// Display content in mobile app
<ScrollView>
  <Text style={styles.title}>{courseContent.data.course.name}</Text>
  <Text style={styles.content}>{courseContent.data.course.content}</Text>

  <Button
    title="Ho√†n th√†nh kh√≥a h·ªçc"
    onPress={() => markAsCompleted(courseId)}
  />
</ScrollView>;
```

#### **4. Course Review:**

```javascript
// After completing course
const review = await api.reviewCourse(courseId, "Kh√≥a h·ªçc r·∫•t b·ªï √≠ch!", 5);
```

---

## üì± FRONTEND SDK C·∫¨P NH·∫¨T (üÜï)

### **Course Methods:**

```javascript
// Basic course operations
await api.getCourses(params);
await api.getCourse(courseId);
await api.enrollInCourse(courseId);

// NEW: Course content & my courses
await api.getCourseContent(courseId); // üÜï L·∫•y n·ªôi dung ƒë·ªÉ ƒë·ªçc
await api.getMyCourses(); // üÜï Kh√≥a h·ªçc ƒë√£ ƒëƒÉng k√Ω

// Reviews
await api.reviewCourse(courseId, review, rating);
await api.getCourseReviews(courseId);
```

### **Complete Course Learning Workflow:**

```javascript
const CourseWorkflow = {
  // 1. Browse courses
  async browseCourses() {
    return await api.getCourses({
      targetAudience: "university_student",
    });
  },

  // 2. Enroll in course
  async enrollCourse(courseId) {
    return await api.enrollInCourse(courseId);
  },

  // 3. Access learning content
  async startLearning(courseId) {
    return await api.getCourseContent(courseId);
  },

  // 4. View my courses
  async viewMyCourses() {
    return await api.getMyCourses();
  },

  // 5. Complete and review
  async completeCourse(courseId, review, rating) {
    return await api.reviewCourse(courseId, review, rating);
  },
};
```

---

## üß™ TESTING COURSE ENDPOINTS (üÜï)

### **Test Course Learning Flow:**

```bash
# 1. Login as student
curl -X POST https://prevention-api-tdt.onrender.com/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"student@example.com","password":"password123"}'

# 2. Browse courses
curl https://prevention-api-tdt.onrender.com/api/v1/courses?targetAudience=university_student

# 3. Get course details
curl https://prevention-api-tdt.onrender.com/api/v1/courses/COURSE_ID

# 4. Enroll in course
curl -X POST https://prevention-api-tdt.onrender.com/api/v1/courses/COURSE_ID/enrollments \
  -H "Authorization: Bearer YOUR_TOKEN"

# 5. Access course content (enrolled users only)
curl -H "Authorization: Bearer YOUR_TOKEN" \
  https://prevention-api-tdt.onrender.com/api/v1/courses/COURSE_ID/content

# 6. View my enrolled courses
curl -H "Authorization: Bearer YOUR_TOKEN" \
  https://prevention-api-tdt.onrender.com/api/v1/enrollments/my-courses

# 7. Submit review
curl -X POST https://prevention-api-tdt.onrender.com/api/v1/courses/COURSE_ID/reviews \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"review":"Kh√≥a h·ªçc r·∫•t b·ªï √≠ch!","rating":5}'
```

---

## üéØ COMPLETE USER JOURNEYS (üÜï C·∫¨P NH·∫¨T)

### **Sinh Vi√™n Learning Journey:**

```
1. Browse Courses ‚Üí Filter by university_student
2. View Course Details ‚Üí Read description & topics
3. Enroll in Course ‚Üí Confirm enrollment
4. Access Course Content ‚Üí Read text-based learning material
5. Complete Learning ‚Üí Mark as completed
6. Write Review ‚Üí Rate & review experience
7. View My Courses ‚Üí Track learning progress
```

### **Content Structure cho Courses:**

```json
{
  "course": {
    "name": "Nh·∫≠n th·ª©c v·ªÅ ma t√∫y cho sinh vi√™n",
    "content": "# Ch∆∞∆°ng 1: T·ªïng quan\n\nN·ªôi dung chi ti·∫øt...\n\n# Ch∆∞∆°ng 2: T√°c h·∫°i\n\nV√≠ d·ª• th·ª±c t·∫ø...\n\n# Ch∆∞∆°ng 3: Ph√≤ng tr√°nh\n\nK·ªπ nƒÉng c·∫ßn thi·∫øt..."
  }
}
```

---

## üìû SUPPORT & UPDATES

### **Latest Changes (9/7/2025):**

1. **üîß Simplified Roles:** Gi·∫£m t·ª´ 6 roles xu·ªëng 3 roles ch√≠nh
2. **üìö Enhanced Course System:** Th√™m content field cho text-based learning
3. **üÜï New Endpoints:** `/courses/:id/content`, `/enrollments/my-courses`
4. **üîÑ Routes Optimization:** S·ª≠a l·ªói typo v√† c·∫£i thi·ªán route structure
5. **üì± Mobile-Ready:** T·ªëi ∆∞u cho mobile app development

### **Breaking Changes:**

- ‚ùå Removed roles: `guest`, `staff`, `manager`
- ‚úÖ Simplified to: `member`, `consultant`, `admin`
- üÜï Course content ch·ªâ accessible cho enrolled users

---

**Last Updated:** 9/7/2025 - Course System Enhancement & Role Simplification
